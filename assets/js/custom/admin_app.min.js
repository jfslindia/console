var jfsl_admin=angular.module("jfsl_admin",["chieffancypants.loadingBar","blockUI","ngMessages","datatables"]);jfsl_admin.config(["cfpLoadingBarProvider",function(t){t.includeSpinner=!1}]),jfsl_admin.config(["blockUIConfig",function(t){t.message="",t.delay=100}]),jfsl_admin.directive("ngNumber",function(){return{require:"ngModel",restrict:"A",link:function(t,e,a,s){s.$parsers.push(function(t){if(null==t)return"";var e=t.toString().replace(/[^0-9]/g,"");return e!=t&&(s.$setViewValue(e),s.$render()),e})}}}),jfsl_admin.directive("ngEnter",function(){return function(e,t,a){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(a.ngEnter,{event:t})}),t.preventDefault())})}}),jfsl_admin.controller("search_panel",["$scope","$http","$compile","cfpLoadingBar","blockUI",function(i,n,d,t,l){i.start=function(){t.start()},i.complete=function(){t.complete()},i.search=function(t){var r=i.search_with,e=i.search_text;i.users=[],t.search_with.$valid&&t.search_text.$valid?(l.start(),n({method:"POST",url:base_url+"console_controller/search_panel",data:{search_with:r,search_text:e}}).then(function(t){if("success"==t.data.status)if(l.stop(),i.users=t.data.result.user_details,$("#user_table_body").html(""),$("#orders_table_body").html(""),UIkit.notification({message:"Succesfully retreived results",status:"success",pos:"top-right",timeout:1e3}),"name"!=r){for(var e=0;e<t.data.result.user_details.length;e++){i.customer_name=t.data.result.user_details[e].name,i.customer_email=t.data.result.user_details[e].email,i.customer_mobile=t.data.result.user_details[e].mobile_number;var a="<tr><td>"+t.data.result.user_details[e].customer_id+" </td><td>"+t.data.result.user_details[e].date+' </td><td>{{customer_name}} </td><td>{{customer_mobile}} </td><td>{{customer_email}} </td><td> <button class="uk-button uk-button-default" ng-click="edit_user('+e+')"><span uk-icon="icon: pencil"></span> Edit</button> </td></tr>',s=d(a)(i);angular.element(document.getElementById("user_table_body")).append(s)}if($("#user_table_block").show(),0<t.data.result.order_details.length){for(e=0;e<t.data.result.order_details.length;e++)$("#orders_table_body").append("<tr><td>"+t.data.result.order_details[e].date+" </td><td>"+t.data.result.order_details[e].pick_up_date+" </td><td>"+t.data.result.order_details[e].customer_id+" </td><td>"+t.data.result.order_details[e].bookingID+" </td><td>"+t.data.result.order_details[e].reference_number+" </td><td>"+t.data.result.order_details[e].order_status+" </td></tr>");$("#orders_table_block").show()}else $("#orders_table_body").html(""),$("#orders_table_block").hide()}else for(e=0;e<t.data.result.user_details.length;e++){a="<tr><td>"+t.data.result.user_details[e].customer_id+" </td><td>"+t.data.result.user_details[e].date+" </td><td>"+t.data.result.user_details[e].name+"</td><td>"+t.data.result.user_details[e].mobile_number+"</td><td>"+t.data.result.user_details[e].email+' </td><td> <button class="uk-button uk-button-default" ng-click="edit_user('+e+')"><span uk-icon="icon: check"></span> Edit</button> </td></tr>',s=d(a)(i),angular.element(document.getElementById("user_table_body")).append(s),$("#user_table_block").show();for(var o=0;o<t.data.result.order_details[e].length;o++)$("#orders_table_body").append("<tr><td>"+t.data.result.order_details[e][o].date+" </td><td>"+t.data.result.order_details[e][o].pick_up_date+" </td><td>"+t.data.result.order_details[e][o].customer_id+" </td><td>"+t.data.result.order_details[e][o].bookingID+" </td><td>"+t.data.result.order_details[e][o].reference_number+" </td><td>"+t.data.result.order_details[e][o].order_status+" </td></tr>");$("#orders_table_block").show()}else"failed"==t.data.status?(l.stop(),UIkit.notification({message:"Nothing to show",status:"danger",pos:"top-right",timeout:1e3})):"error"==t.data.status?(l.stop(),UIkit.notification({message:t.data.message,status:"danger",pos:"top-right",timeout:1e3})):(l.stop(),UIkit.notification({message:"Error",status:"danger",pos:"top-right",timeout:1e3})),$("#user_table_body").html(""),$("#orders_table_body").html(""),$("#user_table_block").hide(),$("#orders_table_block").hide()})):UIkit.notification({message:"Form validation error",status:"danger",pos:"top-right",timeout:1e3})},i.edit_user=function(t){var e=i.users[t];i.customer_name=e.name,i.customer_mobile=parseInt(e.mobile_number),i.customer_email=e.email,angular.element(document.getElementById("customer_name")).val(e.name),angular.element(document.getElementById("customer_mobile")).val(parseInt(e.mobile_number)),angular.element(document.getElementById("customer_email")).val(e.email);var a='<button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button><button class="uk-button uk-button-default uk-modal-close" ng-click="save_user('+e.id+","+t+')" >Save</button>',s=d(a)(i);d("#customer_name")(i),d("#customer_mobile")(i),d("#customer_email")(i),angular.element(document.getElementById("edit_user_footer")).html(""),angular.element(document.getElementById("edit_user_footer")).append(s),UIkit.modal($("#user_edit")).show()},i.save_user=function(t,e){var a=t,s=i.edit_user_form.customer_name.$modelValue,o=i.edit_user_form.customer_mobile.$modelValue,r=i.edit_user_form.customer_email.$modelValue;i.edit_user_form.customer_name.$valid&&i.edit_user_form.customer_mobile.$valid&&i.edit_user_form.customer_email.$valid&&(l.start(),n({method:"POST",url:base_url+"console_controller/save_user",data:{user_id:a,name:s,phone:o,email:r}}).then(function(t){l.stop(),"success"==t.data.status?(UIkit.notification({message:t.data.message,status:"success",pos:"top-right",timeout:1e3}),i.users[e]=t.data.user_details,i.customer_name=t.data.user_details.name,i.customer_mobile=t.data.user_details.mobile_number,i.customer_email=t.data.user_details.email):"failed"==t.data.status?UIkit.notification({message:t.data.message,status:"danger",pos:"top-right",timeout:1e3}):UIkit.notification({message:"Failed to update",status:"danger",pos:"top-right",timeout:1e3})}))}}]),jfsl_admin.controller("change_passwd",["$scope","$http","$compile","cfpLoadingBar","blockUI",function(s,o,t,e,r){s.start=function(){e.start()},s.complete=function(){e.complete()},s.change_password=function(){var t=s.old_password,e=s.new_password,a=s.re_enter_password;t!=e?e==a?""!=e?(r.start(),o({method:"POST",url:base_url+"console_controller/change_password",data:{old_password:t,new_password:e}}).then(function(t){"success"==t.data.status?(UIkit.notification({message:"Password changed",status:"success",pos:"top-right",timeout:1e3}),setTimeout(function(){window.location=base_url+"console/logout"},1e3)):"failed"==t.data.status?(r.stop(),UIkit.notification({message:"Failed",status:"danger",pos:"top-right",timeout:1e3})):"wrong_password"==t.data.status&&(r.stop(),UIkit.notification({message:"Wrong Password",status:"warning",pos:"top-right",timeout:1e3}))})):(r.stop(),UIkit.notification({message:"Password can not be empty",status:"warning",pos:"top-right",timeout:1e3})):(r.stop(),UIkit.notification({message:"Enter the same password",status:"danger",pos:"top-right",timeout:1e3})):(r.stop(),UIkit.notification({message:"Enter a new password",status:"warning",pos:"top-right",timeout:1e3}))}}]),jfsl_admin.controller("qc_logs",["$scope","$http","$compile","cfpLoadingBar","blockUI",function(o,r,t,e,i){o.mode="default",o.results=[],o.orderByField="title",o.reverseSort=!1,o.start=function(){e.start()},o.complete=function(){e.complete()},o.generate_report=function(){var t=!1,e=null,a=null,s=o.time_period;console.log(s),0==s?t=!(a=e=null):o.start_date&&o.end_date?(t=!0,o.start_time||(o.start_time="00"),o.end_time||(o.end_time="00"),e=o.start_date+" "+o.start_time+":00:00",a=o.end_date+" "+o.end_time+":00:00"):t=!1,t?(i.start(),r({method:"POST",url:base_url+"console_controller/generate_qc_logs_report",data:{start_datetime:e,end_datetime:a}}).then(function(t){i.stop(),"success"==t.data.status?UIkit.notification({message:t.data.message,status:"success",pos:"top-right",timeout:6e4}):UIkit.notification({message:t.data.message,status:"warning",pos:"top-right",timeout:4e3})})):UIkit.notification({message:"Please enter valid details",status:"warning",pos:"top-right",timeout:4e3})},o.search_tag_id=function(){i.start(),""!=o.search&&null!=o.search?window.location=base_url+"console/qc_logs?keyword="+o.search:(i.stop(),UIkit.notification({message:"Please enter a valid search query!",status:"warning",pos:"top-right",timeout:4e3}))}}]),jfsl_admin.controller("qa_logs",["$scope","$http","$compile","cfpLoadingBar","blockUI",function(o,r,t,e,i){o.mode="default",o.results=[],o.get_qa_data_for_chart=function(){i.start();var a=[],s=[],o=["red","yellow","blue","lavender","green","orange","violet","brown"];r({method:"POST",url:base_url+"console_controller/get_qa_data_for_chart"}).then(function(t){if(i.stop(),0<t.data.length){for(var e=0;e<t.data.length;e++)a.push(t.data[e].reason),s.push(t.data[e].count);new Chart($("#qa_logs_pie_chart"),{type:"pie",data:{labels:a,datasets:[{label:"Total registered Users",backgroundColor:o,data:s}]},options:{responsive:!0,title:{display:!0,text:"Total QA logs statistics"}}})}},function(){})}(),o.orderByField="title",o.reverseSort=!1,o.start=function(){e.start()},o.complete=function(){e.complete()},o.qa_logs_close_chart=function(){$("#chart_card").hide()},o.generate_report=function(){var t=!1,e=null,a=null,s=o.time_period;console.log(s),0==s?t=!(a=e=null):o.start_date&&o.end_date?(t=!0,o.start_time||(o.start_time="00"),o.end_time||(o.end_time="00"),e=o.start_date+" "+o.start_time+":00:00",a=o.end_date+" "+o.end_time+":00:00"):t=!1,t?(i.start(),r({method:"POST",url:base_url+"console_controller/generate_qa_logs_report",data:{start_datetime:e,end_datetime:a}}).then(function(t){i.stop(),"success"==t.data.status?UIkit.notification({message:t.data.message,status:"success",pos:"top-right",timeout:6e4}):UIkit.notification({message:t.data.message,status:"warning",pos:"top-right",timeout:4e3})})):UIkit.notification({message:"Please enter valid details",status:"warning",pos:"top-right",timeout:4e3})},o.search_tag_id=function(){i.start(),""!=o.search&&null!=o.search?window.location=base_url+"console/qa_logs?keyword="+o.search:(i.stop(),UIkit.notification({message:"Please enter a valid search query!",status:"warning",pos:"top-right",timeout:4e3}))}}]),jfsl_admin.controller("qa_reasons",["$scope","$http","cfpLoadingBar","blockUI",function(s,e,t,a){s.mode="default",s.results=[],s.get_qa_reasons=(a.start(),void e({method:"POST",url:base_url+"console_controller/get_qa_reasons"}).then(function(t){a.stop(),0<t.data.length?s.results={qa_reasons:t.data}:(s.results={qa_reasons:[]},UIkit.notification({message:"No reasons found",status:"warning",pos:"top-right",timeout:1200}))},function(){})),s.orderByField="title",s.reverseSort=!1,s.start=function(){t.start()},s.complete=function(){t.complete()},s.add_qa_reason=function(){s.mode="add",$("#qa_reason_modal_details").removeAttr("index"),$("#qa_reason_modal_details").removeAttr("qa_reason_id"),$("#modal-title").html("Add a QA Reason"),s.form_reason="",UIkit.modal("#qa_reason_modal").show()},s.save_qa_reason=function(){var t=s.form_reason;t?(UIkit.modal("#qa_reason_modal").hide(),e({method:"POST",url:base_url+"console_controller/save_qa_reason",data:{mode:s.mode,id:$("#qa_reason_modal_details").attr("qa_reason_id"),qa_reason:t}}).then(function(t){if(1!=t.data.length||t.data.status)"existing"==t.data.status?UIkit.notification({message:t.data.message,status:"warning",pos:"top-right",timeout:4e3}):UIkit.notification({message:"Saving failed!",status:"danger",pos:"top-right",timeout:4e3});else{UIkit.modal("#qa_reason_modal").hide();var e=t.data[0];if("add"==s.mode)s.results.qa_reasons.push(e);else if("edit"==s.mode){var a=$("#qa_reason_modal_details").attr("index");s.results.qa_reasons[a]=e}UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:4e3})}},function(t){console.log(t)})):UIkit.notification({message:"Please fill up reason field!",status:"warning",pos:"top-right",timeout:5e3})},s.edit_qa_reason=function(t,e){$("#qa_reason_modal_details").attr("index",e),$("#qa_reason_modal_details").attr("qa_reason_id",t),s.mode="edit",$("#modal-title").html("Edit : "+s.results.qa_reasons[e].Reason),s.form_reason=s.results.qa_reasons[e].Reason,UIkit.modal("#qa_reason_modal").show()},s.delete_qa_reasons=function(){var t=[];$("input[name='qa_reason_row']:checked").each(function(){t.push($(this).val())}),t.length&&t?UIkit.modal.confirm("Do you want to delete this reason?").then(function(){e({method:"post",data:{selected_qa_reasons:t},url:base_url+"console_controller/delete_qa_reasons"}).then(function(t){"success"==t.data.status?(UIkit.notification({message:"Succesfully deleted",status:"success",pos:"top-right",timeout:1200}),setTimeout(function(){location.reload()},1e3)):UIkit.notification({message:"Deletion failed!",status:"danger",pos:"top-right",timeout:1200})},function(){})},function(){}):UIkit.notification({message:"Please select a qa_reason!",status:"warning",pos:"top-right",timeout:5e3})}}]),jfsl_admin.controller("qa_users",["$scope","$http","$compile","cfpLoadingBar","blockUI",function(s,o,t,e,a){s.mode="default",s.results=[],s.get_qa_users=(a.start(),void o({method:"POST",url:base_url+"console_controller/get_qa_users"}).then(function(t){a.stop(),0<t.data.length?s.results={qa_users:t.data}:s.results={qa_users:[]}},function(){})),s.orderByField="title",s.reverseSort=!1,s.start=function(){e.start()},s.complete=function(){e.complete()},s.add_qa_user=function(){s.mode="add",$("#qa_user_modal_details").removeAttr("index"),$("#qa_user_modal_details").removeAttr("qa_user_id"),$("#modal-title").html("Add a QA user"),s.form_name="",s.form_contactno="",s.form_privilege="",s.form_passwd="",UIkit.modal("#qa_user_modal").show()},s.save_qa_user=function(){var t=s.form_name,e=s.form_contactno,a=s.form_passwd;t&&e&&a?(UIkit.modal("#qa_user_modal").hide(),o({method:"POST",url:base_url+"console_controller/save_qa_user",data:{mode:s.mode,id:$("#qa_user_modal_details").attr("qa_user_id"),name:t,contactno:e,passwd:a}}).then(function(t){if(1!=t.data.length||t.data.status)"existing"==t.data.status?UIkit.notification({message:t.data.message,status:"warning",pos:"top-right",timeout:4e3}):UIkit.notification({message:"Saving failed!",status:"danger",pos:"top-right",timeout:4e3});else{UIkit.modal("#qa_user_modal").hide();var e=t.data[0];if("add"==s.mode)s.results.qa_users.push(e);else if("edit"==s.mode){var a=$("#qa_user_modal_details").attr("index");s.results.qa_users[a]=e}UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:4e3})}},function(t){console.log(t)})):UIkit.notification({message:"Please fill up Name/Phone/Password details!",status:"warning",pos:"top-right",timeout:5e3})},s.edit_qa_user=function(t,e){$("#qa_user_modal_details").attr("index",e),$("#qa_user_modal_details").attr("qa_user_id",t),s.mode="edit",$("#modal-title").html("Edit : "+s.results.qa_users[e].Name),s.form_name=s.results.qa_users[e].Name,s.form_contactno=s.results.qa_users[e].Phone,s.form_passwd=s.results.qa_users[e].Password,UIkit.modal("#qa_user_modal").show()},s.delete_qa_users=function(){var t=[];$("input[name='qa_user_row']:checked").each(function(){t.push($(this).val())}),t.length&&t?UIkit.modal.confirm("Do you want to delete this qa_user?").then(function(){o({method:"post",data:{selected_qa_users:t},url:base_url+"console_controller/delete_qa_users"}).then(function(t){"success"==t.data.status?(UIkit.notification({message:"Succesfully deleted",status:"success",pos:"top-right",timeout:1200}),setTimeout(function(){location.reload()},1e3)):UIkit.notification({message:"Deletion failed!",status:"danger",pos:"top-right",timeout:1200})},function(){})},function(){}):UIkit.notification({message:"Please select a qa_user!",status:"warning",pos:"top-right",timeout:5e3})}}]),jfsl_admin.controller("qa_finished_by_users",["$scope","$http","$compile","cfpLoadingBar","blockUI",function(s,e,t,a,o){s.mode="default",s.results=[],s.get_qa_finished_by_users=(o.start(),void e({method:"POST",url:base_url+"console_controller/get_qa_finished_by_users"}).then(function(t){o.stop(),0<t.data.length?s.results={qa_finished_by_users:t.data}:s.results={qa_finished_by_users:[]}},function(){})),s.orderByField="title",s.reverseSort=!1,s.start=function(){a.start()},s.complete=function(){a.complete()},s.add_qa_finished_by_user=function(){s.mode="add",$("#qa_finished_by_user_modal_details").removeAttr("index"),$("#qa_finished_by_user_modal_details").removeAttr("qa_finished_by_user_id"),$("#modal-title").html("Add a QA finished by user"),s.form_name="",UIkit.modal("#qa_finished_by_user_modal").show()},s.save_qa_finished_by_user=function(){var t=s.form_name;t?(UIkit.modal("#qa_finished_by_user_modal").hide(),e({method:"POST",url:base_url+"console_controller/save_qa_finished_by_user",data:{mode:s.mode,id:$("#qa_finished_by_user_modal_details").attr("qa_finished_by_user_id"),name:t}}).then(function(t){if(1!=t.data.length||t.data.status)"existing"==t.data.status?UIkit.notification({message:t.data.message,status:"warning",pos:"top-right",timeout:4e3}):UIkit.notification({message:"Saving failed!",status:"danger",pos:"top-right",timeout:4e3});else{UIkit.modal("#qa_finished_by_user_modal").hide();var e=t.data[0];if("add"==s.mode)s.results.qa_finished_by_users.push(e);else if("edit"==s.mode){var a=$("#qa_finished_by_user_modal_details").attr("index");s.results.qa_finished_by_users[a]=e}UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:4e3})}},function(t){console.log(t)})):UIkit.notification({message:"Please fill up Name!",status:"warning",pos:"top-right",timeout:5e3})},s.edit_qa_finished_by_user=function(t,e){$("#qa_finished_by_user_modal_details").attr("index",e),$("#qa_finished_by_user_modal_details").attr("qa_finished_by_user_id",t),s.mode="edit",$("#modal-title").html("Edit : "+s.results.qa_finished_by_users[e].Name),s.form_name=s.results.qa_finished_by_users[e].Name,UIkit.modal("#qa_finished_by_user_modal").show()},s.delete_qa_finished_by_users=function(){var t=[];$("input[name='qa_finished_by_user_row']:checked").each(function(){t.push($(this).val())}),t.length&&t?UIkit.modal.confirm("Do you want to delete this Finished By user?").then(function(){e({method:"post",data:{selected_qa_finished_by_users:t},url:base_url+"console_controller/delete_qa_finished_by_users"}).then(function(t){"success"==t.data.status?(UIkit.notification({message:"Succesfully deleted",status:"success",pos:"top-right",timeout:1200}),setTimeout(function(){location.reload()},1e3)):UIkit.notification({message:"Deletion failed!",status:"danger",pos:"top-right",timeout:1200})},function(){})},function(){}):UIkit.notification({message:"Please select a qa_finished_by_user!",status:"warning",pos:"top-right",timeout:5e3})}}]),jfsl_admin.controller("dcr",["$scope","$http","$compile","cfpLoadingBar",function(n,d,t,e){n.mode="default",n.results=[],n.get_dcr_users=void d({method:"POST",url:base_url+"console_controller/get_dcr_users"}).then(function(t){0<t.data.length?n.results={dcr_users:t.data}:n.results={dcr_users:[]}},function(){}),n.orderByField="title",n.reverseSort=!1,n.start=function(){e.start()},n.complete=function(){e.complete()},n.edit_dcr_user=function(t,e){$("#dcr_user_modal_details").attr("index",e),$("#dcr_user_modal_details").attr("dcr_user_id",t),n.mode="edit",$("#modal-title").html("Edit : "+n.results.dcr_users[e].Name),n.form_name=n.results.dcr_users[e].Name,n.form_contactno=n.results.dcr_users[e].Phone,n.form_privilege=n.results.dcr_users[e].Privilege;var a=JSON.parse(n.results.dcr_users[e].Branches);for($("input[name='selected_stores']").prop("checked",!1),i=0;i<a.length;i++)$("input[name='selected_stores'][value="+a[i]+"]").prop("checked",!0);n.form_passwd=n.results.dcr_users[e].Password,UIkit.modal("#dcr_user_modal").show()},n.add_dcr_user=function(){n.mode="add",$("#dcr_user_modal_details").removeAttr("index"),$("#dcr_user_modal_details").removeAttr("dcr_user_id"),$("#modal-title").html("Add a DCR user"),n.form_name="",n.form_contactno="",n.form_privilege="",n.form_passwd="",$("input[name='selected_stores']").prop("checked",!1),UIkit.modal("#dcr_user_modal").show()},n.save_dcr_user=function(){var t=n.form_name,e=n.form_contactno,a=n.form_privilege,s=n.form_passwd,o=[],r=[];$("input[name='selected_stores']:checked").each(function(){o.push($(this).val()),r.push($(this).parent().text())}),t&&e&&s?(UIkit.modal("#dcr_user_modal").hide(),d({method:"POST",url:base_url+"console_controller/save_dcr_user",data:{mode:n.mode,id:$("#dcr_user_modal_details").attr("dcr_user_id"),name:t,contactno:e,privilege:a,passwd:s,"stores[]":o,"store_names[]":r}}).then(function(t){if(1!=t.data.length||t.data.status)"existing"==t.data.status?UIkit.notification({message:t.data.message,status:"warning",pos:"top-right",timeout:4e3}):UIkit.notification({message:"Saving failed!",status:"danger",pos:"top-right",timeout:4e3});else{UIkit.modal("#dcr_user_modal").hide();var e=t.data[0];if("add"==n.mode)n.results.dcr_users.push(e);else if("edit"==n.mode){var a=$("#dcr_user_modal_details").attr("index");n.results.dcr_users[a]=e}UIkit.notification({message:"Saved!",status:"success",pos:"top-right",timeout:4e3})}},function(t){console.log(t)})):UIkit.notification({message:"Please fill up Name/Phone/Password and associated branch details!",status:"warning",pos:"top-right",timeout:5e3})},n.delete_dcr_users=function(){var t=[];$("input[name='dcr_user_row']:checked").each(function(){t.push($(this).val())}),t.length&&t?UIkit.modal.confirm("Do you want to delete this dcr_user?").then(function(){d({method:"post",data:{selected_dcr_users:t},url:base_url+"console_controller/delete_dcr_users"}).then(function(t){"success"==t.data.status?(UIkit.notification({message:"Succesfully deleted",status:"success",pos:"top-right",timeout:1200}),setTimeout(function(){location.reload()},1e3)):UIkit.notification({message:"Deletion failed!",status:"danger",pos:"top-right",timeout:1200})},function(){})},function(){}):UIkit.notification({message:"Please select a dcr_user!",status:"warning",pos:"top-right",timeout:5e3})}}]),jfsl_admin.controller("payments",["$scope","$http","$compile","cfpLoadingBar","blockUI",function(o,e,r,t,i){o.start=function(){t.start()},o.complete=function(){t.complete()},$("#from_date").datepicker({maxDate:new Date,dateFormat:"dd-mm-yy"});var s=$("#transactions").DataTable({bDestroy:!0,stateSave:!0,ajax:{url:base_url+"console_controller/get_payment_transactions"},columns:[{data:"TransactionDate"},{data:"CustomerCode"},{data:"EGRNNo"},{data:"DCNo"},{data:"ConsoleVerify",render:function(t,e,a){return"Not verified"==t?'<span class="uk-text-danger" uk-icon="icon: close; ratio: 1.5"></span>':"Verified"==t?'<span class="uk-text-success" uk-icon="icon: check; ratio: 1.5"></span>':t}}]});$("#transactions tbody").on("click","tr",function(){o.current_payment_id=null,o.current_transaction_id=null,$(this).hasClass("selected")?$(this).removeClass("selected"):(s.$("tr.selected").removeClass("selected"),$(this).addClass("selected"));var t=s.row(this).data();o.current_payment_id=t.PaymentId,o.current_transaction_id=t.TransactionId,$("#transaction_details_modal_content_table").html(""),$("#transactions_details_check_pg").html(""),$("#mobk_response").html("");var e='<table class="uk-table uk-table-striped"><tbody><tr><td>TransactionDate</td><td>'+t.TransactionDate+"</td></tr><tr><td>CustomerCode</td><td>"+t.CustomerCode+"</td></tr><tr><td>EGRN</td><td>"+t.EGRNNo+"</td></tr><tr><td>DCNo</td><td>"+t.DCNo+"</td></tr><tr><td>Payment Amount</td><td>â‚¹ "+t.TotalPayableAmount+"</td></tr><tr><td>Payment ID</td><td>"+t.PaymentId+"</td></tr><tr><td>Payment Source</td><td>"+t.PaymentSource+'</td></tr><tr><td colspan="2" class="transaction_modal_warning_text">Below data is saved based on response from the Mobikwik gateway after a transaction.</td></tr><tr><td>Payment Mode</td><td>'+t.PaymentMode+"</td></tr><tr><td>Payment Gateway Status</td><td>"+t.PaymentGatewayStatus+"</td></tr><tr><td>Payment Gateway Description</td><td>"+t.PaymentGatewayStatusDescription+"</td></tr><tr><td>Invoice Number</td><td>"+t.InvoiceNo+"</td></tr><tr><td>PgTransId</td><td>"+t.PgTransId+"</td></tr></tbody></table>";$("#transaction_details_modal_content_table").html(e),$("#transactions_details_check_pg").html("");var a=r('<div class="uk-text-center"><div><button class="uk-button uk-button-default" ng-click="check_pg($event)">Check with Zaakpay for the status</button></div></div>')(o);angular.element(document.getElementById("transactions_details_check_pg")).append(a),UIkit.modal("#transaction_details_modal").show()}),o.check_pg=function(t){$(t.currentTarget).hide(),i.start(),e({method:"POST",url:base_url+"console_controller/check_with_gateway",data:{payment_id:o.current_payment_id,transaction_id:o.current_transaction_id}}).then(function(t){if("success"==t.data.status){if(UIkit.notification({message:"Successfully retrieved response from gateway",status:"success",pos:"top-right",timeout:1e3}),$("#mobk_response").html(""),1!=t.data.verify){var e="";e=1==t.data.settle_button?'<p><label><input class="uk-checkbox" type="checkbox" ng-model="settle"> This transaction needs to be settled.</label></p>':"";var a="<div>"+t.data.pg_response+e+'</div><div><button class="uk-button uk-button-default" ng-click="transaction_verify()">Verify</button></div>',s=r(a)(o);angular.element(document.getElementById("mobk_response")).append(s)}else angular.element(document.getElementById("mobk_response")).append(t.data.pg_response);i.stop()}else i.stop(),UIkit.notification({message:"Failed to get response from gateway",status:"danger",pos:"top-right",timeout:1e3})})},o.transaction_verify=function(){i.start(),e({method:"post",url:base_url+"console_controller/verify_transaction",data:{transaction_id:o.current_transaction_id,payment_id:o.current_payment_id,settle:o.settle}}).then(function(t){"success"==t.data.status?(i.stop(),UIkit.notification({message:"Verified!",status:"success",pos:"top-right",timeout:1e3}),o.settle=!1,UIkit.modal("#transaction_details_modal").hide(),o.get_transactions()):(i.stop(),UIkit.notification({message:"Verification failed!",status:"danger",pos:"top-right",timeout:1e3}))})},o.get_transactions=function(){var t=$("#from_date").val();s.clear(),i.start(),e({method:"get",url:base_url+"console_controller/get_payment_transactions/"+t}).then(function(t){if("success"==t.data.status){UIkit.notification({message:"Successfully retrieved data",status:"success",pos:"top-right",timeout:1e3}),i.stop();var e=t.data.data;s.rows.add(e).draw(),null!=t.data.to_date?$("#date_info").html("Transaction details from "+t.data.from_date+" to "+t.data.to_date):$("#date_info").html("Transaction details from "+t.data.from_date+" onwards")}else i.stop(),UIkit.notification({message:"No data found",status:"warning",pos:"top-right",timeout:1e3})})}}]),jfsl_admin.controller("payment_gateway_center",["$scope","$http","$compile","cfpLoadingBar","blockUI",function(o,s,r,t,i){o.start=function(){t.start()},o.complete=function(){t.complete()},o.search=function(t){var e=o.search_with,a=o.search_text;t.search_text.$valid&&(i.start(),s({method:"POST",url:base_url+"console_controller/search_payment",data:{search_with:e,search_text:a}}).then(function(t){if("success"==t.data.status){i.stop(),UIkit.notification({message:"Successfully retrieved the result",status:"success",pos:"top-right",timeout:1e3}),$("#user_table_body").html("");var e='<tr><td class="uk-text-center">'+t.data.result.customer_details.CUSTOMERCODE+'</td><td class="uk-text-center">'+t.data.result.customer_details.CUSTOMERNAME+'</td><td class="uk-text-center">'+t.data.result.customer_details.CONTACTNUMBER+'</td><td class="uk-text-center">'+t.data.result.customer_details.CUSTOMEREMAIL+'</td><td class="uk-text-center">'+t.data.result.customer_details.BRANCHCODE+'</td><td class="uk-text-center">'+t.data.result.customer_details.BRANCHNAME+'</td><td class="uk-text-center">'+t.data.result.customer_details.CITYNAME+"</td></tr>",a=r(e)(o);if(angular.element(document.getElementById("user_table_body")).append(a),$("#user_table_block").show(),0<t.data.result.transaction_info_details.length){$("#transaction_info_table_body").html("");for(var s=0;s<t.data.result.transaction_info_details.length;s++)$("#transaction_info_table_body").append('<tr><td class="uk-text-center">'+t.data.result.transaction_info_details[s].TransactionDate+' </td><td class="uk-text-center">'+t.data.result.transaction_info_details[s].PaymentId+' </td><td class="uk-text-center">'+t.data.result.transaction_info_details[s].EGRNNo+' </td><td class="uk-text-center">'+t.data.result.transaction_info_details[s].DCNo+' </td><td class="uk-text-center">'+t.data.result.transaction_info_details[s].TotalPayableAmount+' </td><td class="uk-text-center">'+t.data.result.transaction_info_details[s].InvoiceNo+' </td><td class="uk-text-center">'+t.data.result.transaction_info_details[s].Gateway+" </td></tr>");$("#transaction_info_block").show()}else $("#transaction_info_table_body").html(""),$("#transaction_info_block").hide()}else"failed"==t.data.status?(i.stop(),UIkit.notification({message:"Nothing to show",status:"danger",pos:"top-right",timeout:1e3})):(i.stop(),UIkit.notification({message:t.data.message,status:"danger",pos:"top-right",timeout:1e3})),$("#user_table_block").hide(),$("#user_table_body").html(""),$("#transaction_info_table_body").html(""),$("#transaction_info_block").hide()}))}}]);